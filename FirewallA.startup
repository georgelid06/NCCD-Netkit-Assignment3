ifconfig eth0 129.11.254.158/16
ifconfig eth1 192.168.1.1/25

route add default gw 129.11.254.157 eth0

###Port Forwarding
#Port Translation
iptables -t nat -A PREROUTING -i eth0 -p tcp --dport 80 -j REDIRECT --to-port 443 

iptables -t nat -A PREROUTING -i eth0 -p tcp --dport 443 -j DNAT --to-destination 192.168.1.10 
iptables -t nat -A PREROUTING -i eth0 -p udp --dport 53 -j DNAT --to-destination 192.168.1.11
iptables -t nat -A PREROUTING -i eth0 -p tcp --dport 443 -j DNAT
iptables -t nat -A PREROUTING -i eth0 -p tcp --match multiport --dports 25,587,993,995 -j DNAT --to-destination 192.168.1.13
iptables -t nat -A PREROUTING -i eth0 -p udp --dport 1194 -j DNAT --to-destination 192.168.1.14


###firewall rules

iptables -P FORWARD DROP
iptables -A FORWARD -m state --state ESTABLISHED,RELATED -j ACCEPT
iptables -A FORWARD -m state --state INVALID -j DROP
iptables -A FORWARD -s 192.168.1.128/25 -j ACCEPT

#specifying the mail server can only send and recieve encrypted emails
iptables -A FORWARD -p tcp --match multiport --dports 25,587,993,995 -d 192.168.1.13 -j ACCEPT

#specifying the rules for the dns server (only communicate with ext dns server)
iptables -A FORWARD -p tcp --dport 53 -d 8.8.8.8 -s 192.168.1.11 -j ACCEPT

#specifying the rules for the www server
#https://www.sciencedirect.com/topics/computer-science/corporate-web-server
iptables -A FORWARD -p tcp --match multiport --dports 443,80 -s 192.168.1.10 -j ACCEPT
iptables -A FORWARD -p tcp --match multiport --dports 443,80 -s 201.224.19.7 -j ACCEPT
